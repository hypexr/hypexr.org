<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>prog3.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>prog3.cpp</h1><a href="prog3_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* Scott Rippee</span>
00002 <span class="comment">   CSci151</span>
00003 <span class="comment">   Professor: Dr. Juliano</span>
00004 <span class="comment">   Program Name: bibtool</span>
00005 <span class="comment">   Program Number: 2</span>
00006 <span class="comment">   Date: 04.28.03</span>
00007 <span class="comment">   takes LaTeX bibliography files and creates an index of key names</span>
00008 <span class="comment">   and a listing of files.  Searches for key name with -s argument</span>
00009 <span class="comment">*/</span>
00010 
00011 <span class="preprocessor">#include &lt;queue&gt;</span>
00012 <span class="preprocessor">#include "<a class="code" href="bibtool_8h.html">bibtool.h</a>"</span>
00013 
00014 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00015 
00016 <span class="comment">//functions</span>
00017 <span class="keywordtype">void</span> <a class="code" href="prog3_8cpp.html#a0">processCommandLine</a>( <a class="code" href="classBibtool.html">Bibtool</a> &amp;, <span class="keywordtype">int</span>, <span class="keywordtype">char</span> **, <span class="keywordtype">bool</span> &amp;, queue&lt;string&gt; &amp; );
00018 <span class="keywordtype">void</span> <a class="code" href="prog3_8cpp.html#a1">createIndex</a>( <a class="code" href="classBibtool.html">Bibtool</a> &amp; );
<a name="l00019"></a><a class="code" href="prog3_8cpp.html#a2">00019</a> 
00020 <span class="keywordtype">int</span> <a class="code" href="prog3_8cpp.html#a2">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[] )
00021 {
00022         <a class="code" href="classBibtool.html">Bibtool</a> bib;
00023         queue&lt;string&gt; bibFileName_queue;
00024         <span class="keywordtype">int</span> countBibOpenSuccess = 0;
00025         <span class="keywordtype">bool</span> schLstSupplied = <span class="keyword">false</span>;
00026         <a class="code" href="bibtool_8h.html#a3">SearchType</a> idSearch;
00027         <a class="code" href="classIndexOperations.html">IndexOperations</a> indexO;
00028 
00029         <span class="comment">//move through command line picking out commands and saving file names to the bib class</span>
00030         <a class="code" href="prog3_8cpp.html#a0">processCommandLine</a>( bib, argc, argv, schLstSupplied, bibFileName_queue );
00031 
00032         bib.<a class="code" href="classBibtool.html#Bibtoola8">removeOldFiles</a>();           <span class="comment">//get rid of files if they already exist</span>
00033 
00034         <span class="comment">//If search list exist, read in</span>
00035         <span class="keywordflow">if</span>( schLstSupplied )
00036                 bib.<a class="code" href="classBibtool.html#Bibtoola4">getSchLst</a>();
00037                 
00038         <span class="comment">//go through bibFileName vector and process each bib file</span>
00039         <span class="keywordflow">while</span>( !bibFileName_queue.empty() )
00040         {
00041                 <span class="comment">//create index for bib file poped</span>
00042                 <span class="comment">//string tempFileName = bibFileName_queue.front();</span>
00043                 bib.<a class="code" href="classBibtool.html#Bibtoolm9">currentBibFileName</a> = bibFileName_queue.front();
00044                 bibFileName_queue.pop();
00045                 <span class="keywordflow">if</span>( bib.<a class="code" href="classBibtool.html#Bibtoola6">openFileBinary</a>( bib.<a class="code" href="classBibtool.html#Bibtoolm9">currentBibFileName</a> ))
00046                 {
00047                         bib.<a class="code" href="classBibtool.html#Bibtoolm0">fileIndex</a> = countBibOpenSuccess;            <span class="comment">//get file number for index write</span>
00048                         <span class="comment">//bib.writeBibs( bib.currentBibFileName );      //create bibs file here</span>
00049                         <a class="code" href="prog3_8cpp.html#a1">createIndex</a>( bib );
00050                         bib.<a class="code" href="classBibtool.html#Bibtoola7">closeFile</a>();
00051                         countBibOpenSuccess++;  <span class="comment">//get file number we are working on for index write</span>
00052                 }
00053         }
00054 
00055         <span class="comment">//bib.sortNdx();                                //function to sort the index file</span>
00056         <span class="comment">//###</span>
00057         <span class="comment">//bib.sortNdxAuth();</span>
00058         <span class="comment">//bib.sortNdxTitle();</span>
00059         <span class="comment">//which key names in search list (-s) have not been found and output message saying so</span>
00060         <span class="keywordflow">if</span>( bib.<a class="code" href="classBibtool.html#Bibtoolm10">schLstIsOpenable</a> )
00061         {
00062                 <span class="comment">//###  Instead of searching files this is now going to search each data structure</span>
00063                 indexO.<a class="code" href="classIndexOperations.html#IndexOperationsa0">searchBstreeIndex</a>( bib );
00064                 <span class="comment">//indexO.searchHashIndex( bib );</span>
00065                 indexO.<a class="code" href="classIndexOperations.html#IndexOperationsa1">searchRbtreeIndex</a>( bib );
00066 
00067 
00068                 idSearch = <a class="code" href="bibtool_8h.html#a3a2">KEYNAME</a>;
00069                 bib.<a class="code" href="classBibtool.html#Bibtoola10">displayFound</a>( bib.<a class="code" href="classBibtool.html#Bibtoolm11">searchNames_vec</a>, idSearch ); <span class="comment">//writes the files it found to .out</span>
00070                 idSearch = <a class="code" href="bibtool_8h.html#a3a0">AUTHOR</a>;
00071                 bib.<a class="code" href="classBibtool.html#Bibtoola10">displayFound</a>( bib.<a class="code" href="classBibtool.html#Bibtoolm12">searchNamesAuth_vec</a>, idSearch );
00072                 idSearch = <a class="code" href="bibtool_8h.html#a3a1">TITLE</a>;
00073                 bib.<a class="code" href="classBibtool.html#Bibtoola10">displayFound</a>( bib.<a class="code" href="classBibtool.html#Bibtoolm13">searchNamesTitle_vec</a>, idSearch );
00074 
00075         }
00076         <span class="keywordflow">return</span> 0;
00077 }
00078 
00079 
<a name="l00080"></a><a class="code" href="prog3_8cpp.html#a1">00080</a> <span class="comment">//Moves through file processing each entry until we reach the end of the file</span>
00081 <span class="keywordtype">void</span> <a class="code" href="prog3_8cpp.html#a1">createIndex</a>( <a class="code" href="classBibtool.html">Bibtool</a> &amp;bib )
00082 {
00083         <span class="comment">//scan whole file for entries</span>
00084         <span class="keywordflow">while</span>( !bib.<a class="code" href="classBibtool.html#Bibtoola5">endOfFile</a>() )
00085         {
00086                 <span class="keywordflow">if</span>( bib.<a class="code" href="classBibtool.html#Bibtoola2">getType</a>() )                     <span class="comment">//gets characterIndex. If find one then..</span>
00087                         bib.<a class="code" href="classBibtool.html#Bibtoola3">processEntry</a>();             <span class="comment">//processes formating and getsName</span>
00088         }
00089 }
00090 
00091 
<a name="l00092"></a><a class="code" href="prog3_8cpp.html#a0">00092</a> <span class="comment">//Processes the command line</span>
00093 <span class="keywordtype">void</span> <a class="code" href="prog3_8cpp.html#a0">processCommandLine</a>( <a class="code" href="classBibtool.html">Bibtool</a> &amp;bib, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv, <span class="keywordtype">bool</span> &amp;schLstSupplied, queue&lt;string&gt; &amp;bibFileName_queue )
00094 {
00095         string argument_str;
00096         <span class="keywordtype">bool</span> foundBib = <span class="keyword">false</span>;
00097 
00098         <span class="keywordflow">if</span>( argc == 1 )
00099         {
00100                 bib.<a class="code" href="classBibtool.html#Bibtoola1">printHelp</a>();
00101                 exit(1);
00102         }
00103 
00104         <span class="comment">//move through command line arguments</span>
00105         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> x=1; x&lt;argc; x++ )
00106         {
00107                 argument_str = argv[x];
00108                 string::size_type posbib = argument_str.find( <span class="stringliteral">".bib"</span>,0 );
00109                 string::size_type posBIB = argument_str.find( <span class="stringliteral">".BIB"</span>,0 );
00110 
00111                 <span class="comment">//continue checking next arguments for bib extensions</span>
00112                 <span class="keywordflow">if</span>( posbib == string::npos &amp;&amp; posBIB == string::npos ) {
00113                         <span class="keywordflow">if</span>( argument_str == <span class="stringliteral">"-s"</span> &amp;&amp; foundBib ) {
00114                                 <span class="keywordflow">if</span>( x+1 &lt; argc ) {      <span class="comment">//then next argument should be search list</span>
00115                                         bib.<a class="code" href="classBibtool.html#Bibtoolm7">schLstFileName</a> = argv[++x];
00116                                         schLstSupplied = <span class="keyword">true</span>;
00117                                         <span class="comment">//add .out extention for filename to write to</span>
00118                                         bib.<a class="code" href="classBibtool.html#Bibtoolm8">schLstFileOut</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm7">schLstFileName</a>;
00119                                         bib.<a class="code" href="classBibtool.html#Bibtoolm8">schLstFileOut</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm7">schLstFileName</a>.length(),<span class="stringliteral">".out"</span> );
00120                                         <span class="comment">//last argument must be the outFileName</span>
00121 
00122                                         bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a> = argv[x-2];
00123                                         string::size_type pos2bib = bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.find( <span class="stringliteral">".bib"</span>,0 );
00124                                         string::size_type pos2BIB = bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.find( <span class="stringliteral">".BIB"</span>,0 );
00125 
00126                                         <span class="comment">//if the name does not have .bib or .BIB then add the extensions on</span>
00127                                         <span class="keywordflow">if</span>( pos2bib == string::npos &amp;&amp; pos2BIB == string::npos )
00128                                         {
00129                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a> = 
00130                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a> =
00131                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a> = argv[x-2];
00132 
00133                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.length(),<span class="stringliteral">".ndx"</span> );
00134                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a>.length(),<span class="stringliteral">".bfs"</span> );
00135                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a>.length(), <span class="stringliteral">".ndx_author"</span> );
00136                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a>.length(), <span class="stringliteral">".lst_author"</span> );
00137                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a>.length(), <span class="stringliteral">".ndx_title"</span> );
00138                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a>.length(), <span class="stringliteral">".lst_title"</span> );
00139 
00140 
00141                                         <span class="comment">//else it does and replace the .bib with new extension</span>
00142                                         } <span class="keywordflow">else</span> {
00143                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a> = 
00144                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a> =
00145                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a> = argv[x-2];
00146 
00147                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.length() - 4),4,<span class="stringliteral">".ndx"</span> );
00148                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a>.length() - 4),4,<span class="stringliteral">".bfs"</span> );
00149                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a>.length() -4),4, <span class="stringliteral">".ndx_author"</span> );
00150                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a>.length() -4),4, <span class="stringliteral">".lst_author"</span> );
00151                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a>.length() -4),4, <span class="stringliteral">".ndx_title"</span> );
00152                                                 bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a>.length() -4),4, <span class="stringliteral">".lst_title"</span> );
00153 
00154                                         }
00155                                         x = argc;
00156 
00157                                 } <span class="keywordflow">else</span> {
00158                                         <span class="comment">//no search file name included in arguments</span>
00159                                         cout&lt;&lt; <span class="stringliteral">"Error: -s but no search filename following it"</span>&lt;&lt; endl;
00160                                         exit(1);
00161                                 }
00162                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( foundBib ) {
00163                                 <span class="comment">//must be the file to name the .ndx and .bfs</span>
00164                                 bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a> = argv[x];
00165                                 bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.length(), <span class="stringliteral">".ndx"</span> );
00166                                 bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a> = argv[x];
00167                                 bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a>.length(), <span class="stringliteral">".bfs"</span> );
00168                                 bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a> =
00169                                         bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a> = argv[x];
00170                                 bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a>.length(), <span class="stringliteral">".ndx_author"</span> );
00171                                 bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a>.length(), <span class="stringliteral">".lst_author"</span> );
00172                                 bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a>.length(), <span class="stringliteral">".ndx_title"</span> );
00173                                 bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a>.insert( bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a>.length(), <span class="stringliteral">".lst_title"</span> );
00174 
00175 
00176                         }
00177                 } <span class="keywordflow">else</span> {        <span class="comment">//bib file found, add to queue of bib files</span>
00178                         foundBib = <span class="keyword">true</span>;
00179                         bibFileName_queue.push( argument_str );
00180                         <span class="keywordflow">if</span>( x == argc-1 ) {     <span class="comment">//this is the file name because it is last argument</span>
00181                                 
00182                                 bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a> =
00183                                 bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a> = 
00184                                 bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a> = bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a> = argument_str;
00185 
00186                                 bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.replace( bib.<a class="code" href="classBibtool.html#Bibtoolm1">outFileName</a>.length()-4,4,<span class="stringliteral">".ndx"</span> );
00187                                 bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a>.replace( bib.<a class="code" href="classBibtool.html#Bibtoolm2">outFileNameBibs</a>.length()-4,4,<span class="stringliteral">".bfs"</span> );
00188                                 bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm3">ndx_authorFN</a>.length() -4),4, <span class="stringliteral">".ndx_author"</span> );
00189                                 bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm4">lst_authorFN</a>.length() -4),4, <span class="stringliteral">".lst_author"</span> );
00190                                 bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm5">ndx_titleFN</a>.length() -4),4, <span class="stringliteral">".ndx_title"</span> );
00191                                 bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a>.replace( (bib.<a class="code" href="classBibtool.html#Bibtoolm6">lst_titleFN</a>.length() -4),4, <span class="stringliteral">".lst_title"</span> );
00192 
00193                         }       
00194                 }
00195                 
00196                 <span class="keywordflow">if</span>( x == argc-1 &amp;&amp; !foundBib ) {
00197                         cout&lt;&lt; <span class="stringliteral">"Error: Found 0 files with .bib extention entered."</span>&lt;&lt; endl;
00198                         bib.<a class="code" href="classBibtool.html#Bibtoola1">printHelp</a>();        <span class="comment">//not found by now then print help and quit prog</span>
00199                         exit(1);
00200                 }
00201         }
00202 }
</pre></div><hr><address style="align: right;"><small>Generated on Thu Apr 17 05:03:42 2003 for bibtool by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc1 </small></address>
</body>
</html>
